<!-- Mauricio NaÃ±ez Pro A01194458 -->
<!-- Francisco Sanchez Salomon A01634745 -->
<!-- Guilherme Bittencourt De Borba A01194571 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paint3D</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0px 0px 0px 0px;
            overflow: hidden;
        }

        #gui {
            position: absolute;
            top: 0rem;
            left: 80%;
        }
        .leftMenu {
            top: 1%;
            left: 1%;
            width: 20%;
            max-height: 80%;
        }
        .rightMenu {
            top: 1%;
            right: 1%;
            width: 20%;
            max-height: 80%;
        }
        .objButton{
            color: black;
            background-color: aliceblue;
            border-radius: 0%;
            
        }
        .objButton:hover{
            background-color: lightblue;
        }
    </style>
</head>
<body>
    <div class="position-fixed bg-dark text-light rounded-top leftMenu">
        <div class="container-fluid">
            <div class="row">
                <h3 class="text-center">Insert Objects</h3>
            </div>
            <div class="row" id="objMenu">
                <button class="btn objButton p-0">Sword</button>
                <button class="btn objButton p-0">Triangle3d</button>
                <button class="btn objButton p-0">House</button>
                <button class="btn objButton p-0">LetterF</button>
                <button class="btn objButton p-0">Shield</button>
                <button class="btn objButton p-0">Saphire</button>
                <button class="btn objButton p-0">Pentacle</button>
                <button class="btn objButton p-0">Hexagram</button>
                <button class="btn objButton p-0">TripleTriangle</button>
                <button class="btn objButton p-0">Trapezoid</button>
            </div>
            <div class="row">
                <button class="btn btn-sm btn-dark rounded-0 btn-block" id="toggleMenu">Hide</button>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three/build/three.module.js';
        import {OrbitControls} from "https://unpkg.com/three@0.119.0/examples/jsm/controls/OrbitControls.js";
        import Stats from "https://unpkg.com/three/examples/jsm/libs/stats.module.js";

        "using strict";

        let renderer, scene, camera, cameraControl, mesh, stats, floorPlane, insertMenuToggle;
        let globalWireframe = false;
        let visibleFloor = false;
        let statsPanel = true;
        let meshArr = [];

        let gui = new dat.GUI();
        gui.domElement.id = 'gui';

        // Position Menu
        let posMenu = gui.addFolder("Model's Position Menu");

        // Rotation Menu
        let rotMenu = gui.addFolder("Model's Rotation Menu");

        // Model's Appearance Menu
        let appearMenu = gui.addFolder("Model's Appeareance Menu");

        // model
        let listColors = ["White", "Red", "Blue"];

        function addMesh(shape) {
            let geometry, material;

            switch(shape) {
                case 'Sword':
                    mesh = new Sword();
                    break;
                case 'Triangle3d':
                    mesh = new Triangle3d();
                    break;
                case 'House':
                    mesh = new House();
                    break;
                case 'LetterF':
                    mesh = new LetterF();
                    break;
                case 'Shield':
                    mesh = new Shield();
                    break;
                case 'Saphire':
                    mesh = new Saphire();
                    break;
                case 'Pentacle':
                    mesh = new Pentacle();
                    break;
                case 'Hexagram':
                    mesh = new Hexagram();
                    break;
                case 'TripleTriangle':
                    mesh = new TripleTriangle();
                    break;
                case 'Trapezoid':
                    mesh = new Trapezoid();
                    break;
            }
            mesh.name = shape;
            scene.add(mesh);
            meshArr.push(mesh);
        }

        function init() {

            // RENDERER
            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(window.innerWidth, window.innerHeight);
            //renderer.setClearColor(new THREE.Color(0.2, 0.2, 0.35));
            document.body.appendChild(renderer.domElement);

            // SCENE
            scene = new THREE.Scene();

            // CAMERA
            let fov = 60;
            let aspect = window.innerWidth / window.innerHeight;
            let near = 0.1;
            let far = 10000;
            camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
            camera.position.set(0, 1, 3);
            cameraControl = new OrbitControls(camera, renderer.domElement);


            // FLOOR PLANE
            floorPlane = new THREE.Mesh( new THREE.PlaneGeometry( 10000, 10000, 10, 10 ), new THREE.MeshBasicMaterial({color: "white", wireframe: globalWireframe, side: THREE.DoubleSide}) );
            floorPlane.rotation.x = 90 * Math.PI / 180;
            floorPlane.name = "floorPlane";

            addMesh('Sword');

            // General menu
            let globalMenu = gui.addFolder("Global Menu");

            globalMenu.open();

            let model = {
                name: mesh.name,
                bgColor: [0, 0, 0],
                wireframe: mesh.material.wireframe,
                globalWireframe: globalWireframe,
                visibleFloor: visibleFloor,
                statsPanel:  statsPanel,
                rotY: mesh.rotation.y * 180 / Math.PI,
                rotX: mesh.rotation.x * 180 / Math.PI,
                rotZ: mesh.rotation.z * 180 / Math.PI,
                posX: mesh.position.x,
                posY: mesh.position.y,
                posZ: mesh.position.z,
                posHome: function() {
                    model.rotX = 0;
                    model.rotY = 0;
                    model.rotZ = 0;
                    model.posX = 0;
                    model.posY = 0;
                    model.posZ = 0;
                    mesh.position.x = model.posX;
                    mesh.position.y = model.posY;
                    mesh.position.z = model.posZ;
                    mesh.rotation.y = model.rotY;
                    mesh.rotation.x = model.rotX;
                    mesh.rotation.z = model.rotZ;
                },
                listColors,
                defaultItem: listColors[0],
                colorPalette: [255, 255, 255]
            }

            // Global Controls
            let globalWireFrame = globalMenu.add(model, "globalWireframe").name("Global Wireframe").listen().onChange(function(value) {
            globalWireframe = value;
            floorPlane.material.wireframe = value;
                meshArr.forEach((item, i) => {
                item.material.wireframe = value;
                });

            });

            let bgColor = globalMenu.addColor(model, "bgColor").name("Background Color").listen().onChange(function(value) {
                renderer.setClearColor(new THREE.Color(value[0] / 255, value[1] / 255, value[2] / 255));
            });

            let floorToggle = globalMenu.add(model, "visibleFloor").name("Toggle Floor Plane").listen().onChange(function(value) {
                visibleFloor = value;
                if(!visibleFloor) {
                    if (meshArr.indexOf(floorPlane) > -1) {
                    meshArr.splice(meshArr.indexOf(floorPlane), 1);
                    scene.remove( scene.getObjectByName("floorPlane"));
                    }

                }else {
                    scene.add(floorPlane);
                    meshArr.push(floorPlane);
                }
            });

            let statsToggle = globalMenu.add(model, "statsPanel").name("Toggle Stats Panel").listen().onChange(function(value) {
                statsPanel = value;
                stats.dom.style.display = statsPanel ? "" : "none";
            });

            let sliderPosX = posMenu.add(model, "posX").min(-5).max(5).step(0.5).name("X").listen().onChange(function(value) {
                mesh.position.x = value;
            });

            let sliderPosY = posMenu.add(model, "posY").min(-5).max(5).step(0.5).name("Y").listen().onChange(function(value) {
                mesh.position.y = value;
            });

            let sliderPosZ = posMenu.add(model, "posZ").min(-5).max(5).step(0.5).name("Z").listen().onChange(function(value) {
                mesh.position.z = value;
            });

            // Button Position Home
            let btnPosHome = posMenu.add(model, "posHome").name("HOME");


            // Model Orientation
            let sliderRotY = rotMenu.add(model, "rotY").min(-180).max(180).step(5).name("Y (deg)").listen().onChange(function(value) {
                mesh.rotation.y = value * Math.PI / 180;
            });

            // Model Orientation
            let sliderRotX = rotMenu.add(model, "rotX").min(-180).max(180).step(5).name("X (deg)").listen().onChange(function(value) {
                mesh.rotation.x = value * Math.PI / 180;
            });

            // Model Orientation
            let sliderRotZ = rotMenu.add(model, "rotZ").min(-180).max(180).step(5).name("Z (deg)").listen().onChange(function(value) {
                mesh.rotation.z = value * Math.PI / 180;
            });

            // Model Draw Mode
            let chbWireframe = appearMenu.add(model, "wireframe").setValue(true).name("Wireframe").listen().onChange(function(value) {
                mesh.material.wireframe = value;
            });
            let listColor = appearMenu.add(model, "defaultItem", model.listColors).name("Color List").onChange(function(item) {
                mesh.material.color = new THREE.Color(item.toLowerCase());
                model.colorPalette = [mesh.material.color.r * 255, mesh.material.color.g * 255, mesh.material.color.b * 255];
            });
            let colorPalette = appearMenu.addColor(model, "colorPalette").name("Color Palette").listen().onChange(function(color) {
                mesh.material.color = new THREE.Color(color[0]/255, color[1]/255, color[2]/255);
            });

            gui.close();


            // STATS
            stats = new Stats();
            stats.id = 'stats';
            stats.showPanel(0);
            document.body.appendChild(stats.dom);
            stats.dom.style.top = '1%';
            stats.dom.style.left = '22%';

            // OBJECT SELECT

            document.addEventListener( 'click', onDocumentMouseDown );

            function onDocumentMouseDown( event ) {
                event.preventDefault();
                var mouse3D = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1,
                                        -( event.clientY / window.innerHeight ) * 2 + 1,
                                        0.5 );
                let raycaster = new THREE.Raycaster();
                raycaster.setFromCamera( mouse3D, camera );
                var intersects = raycaster.intersectObjects( meshArr );

                if ( intersects.length > 0  && intersects[0].object.name != "floorPlane") {
                    let color = Math.random() * 0xffffff;
                    intersects[ 0 ].object.material.color.setHex( color );
                    mesh = intersects[0].object;

                    model.name = mesh.name;
                    model.colorPalette = [mesh.material.color.r * 255, mesh.material.color.g * 255, mesh.material.color.b * 255];
                    model.posX = mesh.position.x;
                    model.posY = mesh.position.y;
                    model.posZ = mesh.position.z;
                    model.rotX = mesh.rotation.x / Math.PI * 180;
                    model.rotY = mesh.rotation.y / Math.PI * 180;
                    model.rotZ = mesh.rotation.z / Math.PI * 180;
                    model.wireframe = mesh.material.wireframe;
                }
            }

            // Insert Objects Menu
            let insertMenu = document.getElementById("objMenu");
            let toggleMenu = document.getElementById("toggleMenu");
            
            insertMenu.childNodes.forEach((element) => {
                if(element.innerHTML){
                    element.addEventListener('click', (event) => {
                        event.preventDefault();
                        addMesh(element.innerHTML);
                    });
                }
            });

            insertMenuToggle = true;
            toggleMenu.addEventListener("click", () => {
                insertMenuToggle = !insertMenuToggle;
                insertMenu.style.display = insertMenuToggle ? '' : 'none';
                toggleMenu.innerHTML = insertMenuToggle ? 'Hide' : 'Show';
            });

            // RENDER LOOP
            renderLoop();
        }

        function renderLoop() {
            stats.begin();
            renderer.render(scene, camera); // DRAW SCENE
            updateScene();
            stats.end();
            stats.update();
            requestAnimationFrame(renderLoop);
        }

        function updateScene() {

        }

        // EVENT LISTENERS & HANDLERS
        document.addEventListener("DOMContentLoaded", init);

        window.addEventListener("resize", function() {
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });

        class Mesh extends THREE.Mesh {
            constructor() {
                super();
            }
            setWireFrame(value) {
                this.material.wireframe = value;
            }
        }

        class Quad extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [-0.5, 0.5, 0,
                    -0.5, -0.5, 0,
                    0.5, -0.5, 0,
                    0.5, 0.5, 0];
                let indices = [0,1,2, 0,2,3];

                let vi = to3d(0.2, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "white", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Triangle3d extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -0.5, 0, 0,
                    0.5, 0, 0,
                    0, 1, 0,
                ];
                let indices = [
                    // Figura 2d original
                    0,1,2
                ];

                let vi = to3d(0.2, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "white", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class LetterF extends Mesh {
            constructor() {
                super();

                let vertices = [
                    -0.3, -0.8, 0, //0
                    0, -0.8, 0, //1
                    0, -0.2, 0, //2
                    0.5,-0.2,0, //3
                    0.5, 0, 0, //4
                    0, 0, 0, //5
                    0, 0.2, 0, //6
                    0.8, 0.2, 0, //7
                    0.8, 0.4, 0, //8
                    0, 0.4, 0, //9
                    -0.3, 0.4, 0, //10
                    -0.3, 0.2, 0, //11
                    -0.3, 0, 0, //12
                    -0.3, -0.2, 0, //13
                ];
                let indices = [
                    // Figura 2d original
                    0,1,2, 0,2,13,
                    2,3,4, 2,4,5,
                    13,2,5, 13,5,12,
                    12,5,6, 12,6,11,
                    11,6,9, 11,9,10,
                    6,7,8, 6,8,9
                ];

                let vi = to3d(0.2, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "white", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Sword extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -0.2, -0.2, 0, //0
                    -0.7, -0.2, 0, //1
                    -0.7, -0.5, 0, //2
                    -0.2, -0.5, 0, //3
                    -0.2, -1.5, 0, //4
                    0.2, -1.5, 0, //5
                    0.2, -0.5, 0, //6
                    0.7, -0.5, 0, //7
                    0.7, -0.2, 0, //8
                    0.2, -0.2, 0, //9
                    0.2, 1, 0, //10
                    0, 1.5, 0, //11
                    -0.2, 1, 0, //12
                ];
                let indices = [
                    // Figura 2d original
                    0,1,2, 0,2,3,
                    3,4,6, 4,5,6,
                    6,7,8, 8,9,6,
                    9,3,6, 9,0,3,
                    9,10,0, 10,12,0,
                    10,11,12,
                ];

                let vi = to3d(0.2, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "white", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class House extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -0.5, 0, 0,
                    -0.5,-0.5,0,
                    0.5,-0.5,0,
                    0.5, 0, 0,
                    1, 0, 0,
                    0, 0.5,0,
                    -1,0,0
                ];
                let indices = [
                    0,1,2, 2,3,0,
                    3,4,5,
                    0,3,5,
                    6,5,0
                ];

                let vi = to3d(0.8, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "white", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Shield extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    0,  -0.7, 0, //0
                    0.5, 0.7,  0, //1
                    0,    0.7,      0, //2
                    0.5, 1.5,   0, //3
                    0,  1.5,   0, //4
                    0.5,    0.7,      0, //5
                    -0.5,    1.5,      0, //6
                    -0.5,    0.7,      0, //7
                ];
                let indices = [
                    // Figura 2d original
                    0,1,2,
                    2,3,4, 2,3,5,
                    5,6,7, 0,2,7,
                    4,6,2,
                ];

                let vi = to3d(0.5, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "yellow", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Saphire extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    0,  -0.5, 0, //0
                    0.5,   0.5,  0, //1
                    0,   0.5,  0, //2
                    0.5, -0.5, 0, //3
                    0.25, 0.75, 0, //4
                    0.25, -0.75, 0, //5
                    -0.25, 0, 0, //6
                    0.75, 0, 0, //7
                ];
                let indices = [
                    // Figura 2d original
                    0,1,2, 0,3,1,
                    1,2,4,
                    0,3,5,
                    0,2,6,
                    1,3,7,
                ];

                let vi = to3d(0.5, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "blue", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Pentacle extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -0.5, 0.3, 0, //0
                    -0.2, 0.3, 0, //1
                        0,   0.7, 0, //2
                    0.2,  0.3, 0, //3
                    0.5, 0.3, 0, //4
                    0.3, -0.2, 0, //5
                    0.35, -0.6, 0, //6
                    0, -0.4, 0, //7
                    -0.35, -0.6, 0, //8
                    -0.3, -0.2, 0, //5
                ];
                let indices = [
                    // Figura 2d original
                    0,1,9,
                    1,2,3,
                    3,4,5,
                    5,6,7,
                    7,8,9,
                    9,5,7,
                    9,1,5,
                    1,3,5,
                ];


                let vi = to3d(0.5, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "purple", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Hexagram extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -1, 0.5, 0, //0
                    0, 1, 0, //1
                        1,  0.5, 0, //2
                    1,  -0.5, 0, //3
                    0, -1, 0, //4
                    -1, -0.5, 0, //5

                ];
                let indices = [
                    // Figura 2d original
                    0,2,4,
                    5,1,3,
                ];


                let vi = to3d(0.3, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "gold", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class TripleTriangle extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -1,   -1, 0, //0
                    -1,    0, 0, //1
                    -1,    1, 0, //2
                    0,  0.5, 0, //3
                    1,    0, 0, //4
                    0, -0.5, 0, //5

                ];
                let indices = [
                    // Figura 2d original
                    0,1,5,
                    1,2,3,
                    3,4,5,
                ];


                let vi = to3d(0.3, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "red", wireframe: false, side: THREE.DoubleSide});
            }
        }

        class Trapezoid extends Mesh {
            constructor() {
                super();

                // Quad
                let vertices = [
                    -1, 0, 0, //0
                    1, 0, 0, //1
                    0.4, 1, 0, //2
                    -0.4, 1, 0, //3

                ];
                let indices = [
                    // Figura 2d original
                    0,1,3,
                    1,2,3,
                ];


                let vi = to3d(0.3, vertices, indices);

                this.geometry = new THREE.BufferGeometry();
                this.geometry.setAttribute('position', new THREE.Float32BufferAttribute(vi[0], 3));
                this.geometry.setIndex(vi[1]);
                this.material = new THREE.MeshBasicMaterial({color: "blue", wireframe: false, side: THREE.DoubleSide});
            }
        }

        function to3d(width, vertices, indices) {
            let v = [].concat(vertices);
            let i = [].concat(indices);

            let coordAmount = vertices.length / 3;

            for(let idx = 2; idx < vertices.length; idx += 3) {
                v[idx] += width;
            }

            v = vertices.concat(v);

            for(let idx = 0; idx < indices.length; idx++) {
                i[idx] += coordAmount;
            }

            i = indices.concat(i);

            for(let idx = 0; idx < coordAmount * 2; idx++) {

                let a = idx;
                let b = idx + 1;
                let c = idx + coordAmount + 1;

                if(idx >= coordAmount) {
                    b -= 2;
                    c -= 2;
                }

                if(a > coordAmount * 2 - 1) a -= coordAmount * 2;
                if(b > coordAmount * 2 - 1) b -= coordAmount * 2;
                if(c > coordAmount * 2 - 1) c -= coordAmount * 2;

                i.push(a, b, c);
            }

            return [v, i];
        }
    </script>
</body>
</html>
